<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="myPageMapper">

	<!--마이캐릭터 글조회 -->
	<resultMap type="myCharacter" id="myCharacterResultSet">
	<result  property="cNo" column="C_NO" />
	<result  property="mNo" column="M_NO" />
	<result  property="cName" column="C_NAME" />
	<result  property="cLike" column="C_LIKE" />
	<result  property="cContent" column="C_CONTENT" />
	<result  property="cOriginName" column="C_ORIGIN_NAME" />
	<result  property="cChangeName" column="C_CHANGE_NAME" />
	<result  property="cCreateDate" column="C_CREATE_DATE" />
	<result  property="cStatus" column="C_STATUS" />
	</resultMap>
	
	
	<!--마이캐릭터 파일조회 -->
	<resultMap type="myCharacterAttach" id="myCharacterAttachResultSet" >
	<result  property="mCaNo" column="MCA_NO" />
	<result  property="cNo" column="C_NO" />
	<result  property="originName" column="MCA_ORIGIN_NAME" />
	<result  property="changeName" column="MCA_CHANGE_NAME" />
	<result  property="mCaLevel" column="MCA_CA_LEVEL" />
	<result  property="mCaCreateDate" column="MCA_CREATE_DATE" />
	<result  property="mCaStatus" column="MCA_STATUS" />
	</resultMap>


	<!--마이캐릭터 글목록 조회 -->
	<select id="selectchaList" resultMap="myCharacterResultSet">
		SELECT C_NAME,C_CREATE_DATE,MCA_CHANGE_NAME,MCA_ORIGIN_NAME
		FROM TB_CHARACTER
		JOIN TB_MYCHARACTER_ATTACH USING(C_NO)
		WHERE M_NO=#{mNo}
		AND MCA_CA_LEVEL=1
	</select>

     <!--입력 1. 마이캐릭터 게시글 -->
	<insert id="mycharInsert">
			INSERT INTO TB_CHARACTER (
		    C_NO,
		    M_NO,
		    C_NAME,
		    C_CONTENT
		) VALUES (
		    SEQ_CNO.NEXTVAL,
		    #{mNo},
		    #{cName},
		    #{cContent}
		)
	</insert>
	 
	 
	 <!--입력 2. 마이캐릭터 파일리스트  -->
	<insert id="mycharAtInsert" parameterType="myCharacterAttach">
		INSERT INTO TB_MYCHARACTER_ATTACH (
		    MCA_NO,
		    C_NO,
		    MCA_ORIGIN_NAME,
		    MCA_CHANGE_NAME
		) VALUES (
		    SEQ_MCA.NEXTVAL,
		    SEQ_CNO.CURRVAL,
		    #{originName},
		    #{changeName}
		)
	</insert> 
	
	<!-- 마이캐릭터 상세조회수 증가 -->
	<update id="increaseCount" parameterType="_int">
	UPDATE TB_CHARACTER
	SET  C_COUNT=C_COUNT+1 
	WHERE C_NO = #{cNo};
	</update>
	
	
	<!--마이캐릭글 상세조회-->
	<select id="selecectMyChar" resultMap="myCharacterResultSet">
	SELECT * 
	FROM TB_CHARACTER
	WHERE C_NO=#{cNo}
	</select>
	
	
	<!--마이캐릭터글 상세조회 파일 -->
	<select id="selectMyCharList" resultMap="myCharacterAttachResultSet">
	SELECT * 
	FROM TB_MYCHARACTER_ATTACH
	WHERE C_NO=#{cNo}
	AND MCA_STATUS='Y'
	</select>
	
	<!-- 게시글 수정 -->
	<update id="updateMyChar" parameterType="myCharacter">		
	    UPDATE TB_CHARACTER
	    SET C_NAME = #{ cName },
        C_CONTENT = #{ cContent }
	    WHERE C_STATUS = 'Y'
	    AND C_NO = #{ cNo }
	</update>

   <!--첨부파일 수정 -->
   <update id="updateMyCharAttach" parameterType="myCharacterAttach">
   UPDATE TB_MYCHARACTER_ATTACH
   SET MCA_ORIGIN_NAME=#{originName},
   MCA_CHANGE_NAME=#{changeName}
   WHERE MCA_STATUS='Y'
   AND C_NO=#{cNo}
   </update>
   
   
   <!-- 게시글 삭제 -->
   <update id="deleteMyChar" parameterType="_int">
   UPDATE TB_CHARACTER
   SET C_STATUS='N'
   WHERE C_NO=#{cNo}
   </update>
   
   <!-- 첨부파일 삭제 -->
   <delete id="deleteMyCharAttach" parameterType="_int">
    DELETE FROM TB_MYCHARACTER_ATTACH   
    WHERE  C_NO=#{cNo}
   </delete>
   
	

</mapper>
